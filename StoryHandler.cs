/* StoryHandler class to hold all StoryHandler relevant to a session.
 */

using cs;
using cs.UI;

class StoryHandler {
    Space current;
    bool done = false;



  public Dictionary<string, Scene> Scenes { get; set; }
  public Dictionary<int, Area> Areas { get; set; }
  private Scene? currentScene { get; set; }
  StoryBuilder StoryBuilder { get; set; }

  public UII UIHandler { get; set; }


  // New constructor with respect to our design. 
  // With respect to dependency of our UIHandler.
  public StoryHandler(UII uiHandler, Space node)
  {
    UIHandler = uiHandler;
    StoryBuilder = new StoryBuilder();
    current = node;
    }



  /// <summary>
  /// Sets current scene to intial scene, and draws it.
  /// </summary>
  public void Start()
  {
        //currentScene = StoryBuilder.getIntiialScene();
        //UIHandler.DrawScene(currentScene, this);
        this.LoadScenes();

  }
  /// <summary>
  /// Checks wether userinput corresponds to any choice, and proceeeds if true, otherwise, DrawError is called.
  /// </summary>
  /// <param name="usrInp"></param>
  public void PerformChoice(string usrInp)
  {
    int usrInpValue = Int32.Parse(usrInp);
    Scene sceneProxy = StoryBuilder.FindScene(usrInpValue);
    if (currentScene!.Choices.Exists(_ => _.SceneObj == sceneProxy))
    {
      currentScene = sceneProxy;
      UIHandler.DrawScene(currentScene, this);
    }
    else { UIHandler.DrawError("Scene does not exist.."); }


  }

    public Space GetCurrent()
    {
        return current;
    }

    //If the next space is null, prints message and starts the game over
    public void Transition(string direction)
    {
        Space next = current.FollowEdge(direction);
        if (next == null)
        {
            Console.WriteLine("You are confused, and walk in a circle looking for '" + direction + "'. In the end you give up 游땰");
        }
        else
        {
            current.Goodbye();
            current = next;
            current.Welcome();
        }
    }

    // public void SwitchScene(string sceneName)
    // {
    //   Scene scene = Scenes[sceneName];
    //   currentScene = scene;
    // }

    public void MakeDone ()
    {
        done = true;
    }
  
    public bool IsDone () 
    {
        return done;
    }


  /// <summary>
  /// Creates scenes and adds them to the Scenes dictionary
  /// </summary>
  public void LoadScenes()
  {
    Areas = new Dictionary<int, Area>
    {
      {0, new Area(0, "Dinmors indgang")},
      {1, new Area(1, "Dinmors k칮kken")},
      {2, new Area(2, "Dinmors badev칝relse")},
      {3, new Area(3, "Dinmors k칝lder游뱁")},
    };

    string jegErVedAtV칝reTr칝tNu = "112431243124312431243124312431243124312431243124312431243jj12431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243124312431243243";
    
        
        StoryBuilder.AddScene(new Scene(0, "Start 1", jegErVedAtV칝reTr칝tNu, Areas[0],
            new List<SceneChoice> {
            new SceneChoice(2, "Smid kniven, og kast dig ind i badev칝relset."),
            new SceneChoice(3, "Arbejde p친 dine daglige steps, og g친 ned ad trapperne til k칝lderen.")
            }));

    StoryBuilder.AddScene(new Scene(1, "Start 2", jegErVedAtV칝reTr칝tNu, Areas[1],
        new List<SceneChoice> {
            new SceneChoice(2, "Smid kniven, og kast dig ind i badev칝relset."),
            new SceneChoice(3, "Arbejde p친 dine daglige steps, og g친 ned ad trapperne til k칝lderen.")
        }));

    // Add the target scenes
    StoryBuilder.AddScene(new Scene(2, "Badev칝relset", "Du er nu i badev칝relset.", Areas[2], new List<SceneChoice>()));
    StoryBuilder.AddScene(new Scene(3, "K칝lderen", "Du g친r ned i k칝lderen.", Areas[3], new List<SceneChoice>()));

    StoryBuilder.LinkScenes();
  }
}

